/**
 * 02. Task Queue (Macrotask Queue) - ì •ë‹µ
 *
 * ì´ íŒŒì¼ì€ 02-task-queue.jsì˜ ëª¨ë“  TODO ë¬¸ì œ ì •ë‹µì„ í¬í•¨í•©ë‹ˆë‹¤.
 */

console.log("=== Task Queue ì •ë‹µ ===\n");

/**
 * TODO 1 ì •ë‹µ: ì‹¤í–‰ ìˆœì„œ ì˜ˆì¸¡í•˜ê¸°
 */

console.log("--- TODO 1 ì •ë‹µ: ì‹¤í–‰ ìˆœì„œ ì˜ˆì¸¡ ---\n");

console.log("ì‹œì‘");

setTimeout(() => {
	console.log("íƒ€ì´ë¨¸ 1");
}, 0);

setTimeout(() => {
	console.log("íƒ€ì´ë¨¸ 2");
}, 0);

console.log("ì¢…ë£Œ");

/**
 * ì˜ˆìƒ ì¶œë ¥ ìˆœì„œ:
 * 1. "ì‹œì‘"
 * 2. "ì¢…ë£Œ"
 * 3. "íƒ€ì´ë¨¸ 1"
 * 4. "íƒ€ì´ë¨¸ 2"
 *
 * ì´ìœ :
 *
 * [ë™ê¸° ì½”ë“œ ì‹¤í–‰]
 * 1. "ì‹œì‘" ì¶œë ¥ â†’ Call Stackì—ì„œ ì¦‰ì‹œ ì‹¤í–‰
 * 2. setTimeout 1 â†’ Task Queueì— ë“±ë¡
 * 3. setTimeout 2 â†’ Task Queueì— ë“±ë¡
 * 4. "ì¢…ë£Œ" ì¶œë ¥ â†’ Call Stackì—ì„œ ì¦‰ì‹œ ì‹¤í–‰
 * 5. Call Stack ë¹„ì–´ìˆìŒ
 *
 * [ë¹„ë™ê¸° ì½”ë“œ ì‹¤í–‰]
 * 6. ì´ë²¤íŠ¸ ë£¨í”„ê°€ Task Queue í™•ì¸
 * 7. "íƒ€ì´ë¨¸ 1" ì½œë°± ì‹¤í–‰
 * 8. "íƒ€ì´ë¨¸ 2" ì½œë°± ì‹¤í–‰
 *
 * í•µì‹¬: setTimeout(0)ë„ ë™ê¸° ì½”ë“œë³´ë‹¤ ëŠ¦ê²Œ ì‹¤í–‰ë¨!
 */

setTimeout(() => {
	console.log("\n==================================================\n");

	/**
	 * TODO 2 ì •ë‹µ: ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ ë§Œë“¤ê¸°
	 */

	console.log("--- TODO 2 ì •ë‹µ: ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ ---\n");

	function startCountdown(n) {
		console.log(n);

		if (n === 0) {
			console.log("ë°œì‚¬! ğŸš€");
			return;
		}

		// 1ì´ˆ í›„ì— ë‹¤ìŒ ì¹´ìš´íŠ¸ë‹¤ìš´ í˜¸ì¶œ (ì¬ê·€)
		setTimeout(() => {
			startCountdown(n - 1);
		}, 1000);
	}

	console.log("ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘:");
	startCountdown(3);

	/**
	 * ì‹¤í–‰ íë¦„:
	 *
	 * [0ì´ˆ] startCountdown(3) í˜¸ì¶œ
	 *   â†’ "3" ì¶œë ¥
	 *   â†’ 1ì´ˆ í›„ ì‹¤í–‰í•  ì½œë°±ì„ Task Queueì— ë“±ë¡
	 *
	 * [1ì´ˆ] ì½œë°± ì‹¤í–‰ â†’ startCountdown(2) í˜¸ì¶œ
	 *   â†’ "2" ì¶œë ¥
	 *   â†’ 1ì´ˆ í›„ ì‹¤í–‰í•  ì½œë°±ì„ Task Queueì— ë“±ë¡
	 *
	 * [2ì´ˆ] ì½œë°± ì‹¤í–‰ â†’ startCountdown(1) í˜¸ì¶œ
	 *   â†’ "1" ì¶œë ¥
	 *   â†’ 1ì´ˆ í›„ ì‹¤í–‰í•  ì½œë°±ì„ Task Queueì— ë“±ë¡
	 *
	 * [3ì´ˆ] ì½œë°± ì‹¤í–‰ â†’ startCountdown(0) í˜¸ì¶œ
	 *   â†’ "0" ì¶œë ¥
	 *   â†’ "ë°œì‚¬! ğŸš€" ì¶œë ¥
	 *   â†’ return (ì¢…ë£Œ)
	 *
	 * ì£¼ì˜: ì¬ê·€ì ìœ¼ë¡œ setTimeoutì„ í˜¸ì¶œí•˜ë¯€ë¡œ
	 * Call Stack Overflowê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!
	 */
}, 2000);

setTimeout(() => {
	console.log("\n==================================================\n");

	/**
	 * TODO 3 ì •ë‹µ: ìˆœì°¨ì  ë©”ì‹œì§€ ì¶œë ¥ê¸°
	 */

	console.log("--- TODO 3 ì •ë‹µ: ìˆœì°¨ì  ë©”ì‹œì§€ ì¶œë ¥ê¸° ---\n");

	function printMessages(messages, delay) {
		messages.forEach((message, index) => {
			setTimeout(() => {
				console.log(`${index + 1}. ${message}`);
			}, delay * index);
		});
	}

	const messages = ["ì²« ë²ˆì§¸", "ë‘ ë²ˆì§¸", "ì„¸ ë²ˆì§¸", "ë„¤ ë²ˆì§¸"];
	console.log("ë©”ì‹œì§€ ì¶œë ¥ ì‹œì‘:");
	printMessages(messages, 500);

	/**
	 * ì‹¤í–‰ íë¦„:
	 *
	 * [ì¦‰ì‹œ] "ë©”ì‹œì§€ ì¶œë ¥ ì‹œì‘:" ì¶œë ¥
	 * [ì¦‰ì‹œ] forEachê°€ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©° 4ê°œì˜ setTimeout ë“±ë¡
	 *   - setTimeout(..., 0)    â†’ ì²« ë²ˆì§¸ ë©”ì‹œì§€
	 *   - setTimeout(..., 500)  â†’ ë‘ ë²ˆì§¸ ë©”ì‹œì§€
	 *   - setTimeout(..., 1000) â†’ ì„¸ ë²ˆì§¸ ë©”ì‹œì§€
	 *   - setTimeout(..., 1500) â†’ ë„¤ ë²ˆì§¸ ë©”ì‹œì§€
	 *
	 * [0ms]    "1. ì²« ë²ˆì§¸" ì¶œë ¥
	 * [500ms]  "2. ë‘ ë²ˆì§¸" ì¶œë ¥
	 * [1000ms] "3. ì„¸ ë²ˆì§¸" ì¶œë ¥
	 * [1500ms] "4. ë„¤ ë²ˆì§¸" ì¶œë ¥
	 *
	 * í•µì‹¬ í¬ì¸íŠ¸:
	 * - forEachëŠ” ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ 4ê°œì˜ íƒ€ì´ë¨¸ë¥¼ í•œ ë²ˆì— ë“±ë¡
	 * - ê° íƒ€ì´ë¨¸ëŠ” delay * index ì‹œê°„ í›„ì— Task Queueì— ì¶”ê°€ë¨
	 * - ì§€ì—° ì‹œê°„ì´ ë‹¤ë¥´ë¯€ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ì¶œë ¥ë¨
	 */
}, 8000);

setTimeout(() => {
	console.log("\n==================================================\n");

	/**
	 * TODO 4 ì •ë‹µ: setIntervalë¡œ ë°˜ë³µ ì‘ì—… ë§Œë“¤ê¸°
	 */

	console.log("--- TODO 4 ì •ë‹µ: setInterval ë°˜ë³µ ì‘ì—… ---\n");

	let count = 0;

	const intervalId = setInterval(() => {
		console.log(`ì¹´ìš´íŠ¸: ${count}`);
		count++;

		// 5ì— ë„ë‹¬í•˜ë©´ interval ì¤‘ì§€
		if (count > 5) {
			clearInterval(intervalId);
			console.log("ì¹´ìš´íŠ¸ ì¢…ë£Œ");
		}
	}, 1000);

	/**
	 * setInterval vs setTimeout ì¬ê·€:
	 *
	 * [setInterval]
	 * - ì¼ì • ê°„ê²©ìœ¼ë¡œ ìë™ ë°˜ë³µ
	 * - clearIntervalë¡œ ì¤‘ì§€í•´ì•¼ í•¨
	 * - ê°„ê²©ì´ ì •í™•í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ (ì´ì „ ì‹¤í–‰ì´ ì˜¤ë˜ ê±¸ë¦¬ë©´)
	 *
	 * [setTimeout ì¬ê·€]
	 * - ì´ì „ ì‹¤í–‰ì´ ì™„ë£Œëœ í›„ ë‹¤ìŒ íƒ€ì´ë¨¸ ì‹œì‘
	 * - ë” ì •í™•í•œ ê°„ê²© ì œì–´ ê°€ëŠ¥
	 * - ëª…ì‹œì ìœ¼ë¡œ ì¤‘ì§€í•˜ì§€ ì•Šì•„ë„ ë¨
	 *
	 * ì‹¤í–‰ íë¦„:
	 * [0ì´ˆ]  ì¹´ìš´íŠ¸: 0
	 * [1ì´ˆ]  ì¹´ìš´íŠ¸: 1
	 * [2ì´ˆ]  ì¹´ìš´íŠ¸: 2
	 * [3ì´ˆ]  ì¹´ìš´íŠ¸: 3
	 * [4ì´ˆ]  ì¹´ìš´íŠ¸: 4
	 * [5ì´ˆ]  ì¹´ìš´íŠ¸: 5
	 * [6ì´ˆ]  countê°€ 6ì´ ë˜ì–´ clearInterval í˜¸ì¶œ â†’ "ì¹´ìš´íŠ¸ ì¢…ë£Œ"
	 */
}, 12000);

setTimeout(() => {
	console.log("\n==================================================\n");

	/**
	 * ë³´ë„ˆìŠ¤: setTimeout vs setInterval ë¹„êµ
	 */

	console.log("--- ë³´ë„ˆìŠ¤: setTimeout vs setInterval ---\n");

	// setTimeout ì¬ê·€ ë°©ì‹
	console.log("[setTimeout ì¬ê·€]");
	let count1 = 0;

	function repeatWithTimeout() {
		console.log(`setTimeout: ${count1}`);
		count1++;

		if (count1 < 3) {
			setTimeout(repeatWithTimeout, 1000);
		}
	}

	repeatWithTimeout();

	// setInterval ë°©ì‹
	setTimeout(() => {
		console.log("\n[setInterval]");
		let count2 = 0;

		const intervalId = setInterval(() => {
			console.log(`setInterval: ${count2}`);
			count2++;

			if (count2 >= 3) {
				clearInterval(intervalId);
			}
		}, 1000);
	}, 4000);

	/**
	 * ì°¨ì´ì :
	 *
	 * [setTimeout ì¬ê·€]
	 * - ì´ì „ ì‘ì—… ì™„ë£Œ í›„ â†’ íƒ€ì´ë¨¸ ì‹œì‘ â†’ ëŒ€ê¸° â†’ ë‹¤ìŒ ì‘ì—…
	 * - ì‘ì—… ì‹œê°„ì´ ê¸¸ì–´ë„ ì¼ì •í•œ ê°„ê²© ìœ ì§€ ê°€ëŠ¥
	 * - ë” ì•ˆì „í•˜ê³  ì˜ˆì¸¡ ê°€ëŠ¥
	 *
	 * [setInterval]
	 * - íƒ€ì´ë¨¸ ì‹œì‘ â†’ ì‘ì—… ì‹¤í–‰ â†’ íƒ€ì´ë¨¸ ì‹œì‘ â†’ ì‘ì—… ì‹¤í–‰
	 * - ì‘ì—… ì‹œê°„ì´ ê°„ê²©ë³´ë‹¤ ê¸¸ë©´ ì—°ì† ì‹¤í–‰ë  ìˆ˜ ìˆìŒ
	 * - ê°„ë‹¨í•˜ì§€ë§Œ ì£¼ì˜ í•„ìš”
	 */
}, 20000);

setTimeout(() => {
	console.log("\n==================================================\n");

	/**
	 * í•µì‹¬ ì •ë¦¬
	 *
	 * âœ… Task QueueëŠ” ë¹„ë™ê¸° ì‘ì—…ì´ ëŒ€ê¸°í•˜ëŠ” FIFO í
	 * âœ… setTimeout(0)ë„ ë™ê¸° ì½”ë“œ ì´í›„ì— ì‹¤í–‰ë¨
	 * âœ… íƒ€ì´ë¨¸ëŠ” ìµœì†Œ ì§€ì—° ì‹œê°„ì„ ë³´ì¥ (ì •í™•í•œ ì‹œê°„ ì•„ë‹˜)
	 * âœ… setIntervalì€ clearIntervalë¡œ ë°˜ë“œì‹œ ì •ë¦¬
	 * âœ… setTimeout ì¬ê·€ê°€ setIntervalë³´ë‹¤ ì•ˆì „í•œ ê²½ìš° ë§ìŒ
	 *
	 * ë‹¤ìŒ í•™ìŠµ: 03-microtask-queue.js
	 */

	console.log("\n=== 02. Task Queue ì •ë‹µ í™•ì¸ ì™„ë£Œ! ===\n");
}, 30000);
